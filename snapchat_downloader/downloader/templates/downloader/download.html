{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Download Snapchat Memories</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="{% static 'downloader/js/download.js' %}"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .download-options {
            margin: 20px 0;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .download-config {
            margin-bottom: 20px;
        }
        
        .download-methods {
            display: flex;
            flex-direction: row;  /* Changed to row */
            gap: 15px;
            margin-bottom: 20px;
        }

        .download-button-container {
            flex: 1;  /* Each container takes equal space */
            max-width: 50%;  /* Ensure each side takes no more than half */
        }

        .download-button {
            width: 100%;
            padding: 15px;
            text-align: left;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .download-button:hover {
            background-color: #45a049;
        }

        .download-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .download-method-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .performance-details {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
        }

        .progress-container {
            width: 100%;
            background-color: #f0f0f0;
            border-radius: 4px;
            padding: 1px;
            margin-top: 10px;
        }

        .progress-bar {
            height: 20px;
            background-color: #4CAF50;
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .status {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .status-text {
            margin-bottom: 10px;
        }

        .download-list {
            margin: 20px 0;
        }

        .download-list ul {
            list-style-type: none;
            padding-left: 20px;
        }

        .month-item {
            margin: 5px 0;
        }

        .year-item {
            margin: 10px 0;
        }

        .year-item label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Download Snapchat Memories</h1>
    
    <div class="download-options">
        <h3>Configure Download:</h3>

        <div class="download-methods">
            <!-- Left side: Direct download with config -->
            <div class="download-button-container">
                <button id="directDownloadButton" class="download-button">
                    <strong>Download Files Directly</strong><br>
                    <span style="font-size: 0.9em">Files stay in your browser, manual organization needed</span>
                </button>
                
                <!-- Parallel download config under direct download button -->
                <div class="download-config" style="margin-top: 10px; background-color: #f5f5f5; padding: 10px; border-radius: 4px;">
                    <label for="workerCount">Parallel Downloads (1-6):</label>
                    <input type="range" id="workerCount" min="1" max="6" value="3" style="width: 100%; margin: 5px 0;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666; font-size: 0.9em;">Current: <span id="workerCountDisplay">3</span></span>
                        <span style="color: #666; font-size: 0.9em;">Higher = faster but may fail</span>
                    </div>
                </div>
            </div>

            <!-- Right side: ZIP download -->
            <div class="download-button-container">
                <button id="zipDownloadButton" class="download-button">
                    <strong>Download as ZIP Files</strong><br>
                    <span style="font-size: 0.9em">Organized by month, requires server processing</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Performance log section -->
    <div id="performanceLog" style="margin-top: 20px; display: none;">
        <h3>Download Performance</h3>
        <div id="performanceDetails" class="performance-details">
            <!-- Performance metrics will be inserted here -->
        </div>
    </div>

    <div class="download-list">
        <form>
            {% if links_count %}
                <ul>
                {% for year, months in links_count.items %}
                    <li class="year-item">
                        <label>
                            <input type="checkbox" name="selected_years" value="{{ year }}"> {{ year }}
                        </label>
                        <ul>
                        {% for month, count in months.items %}
                            <li class="month-item">
                                <label>
                                    <input type="checkbox" name="selected_months" value="{{ year }}-{{ month }}"> 
                                    {{ month }} ({{ count }} media files)
                                </label>
                            </li>
                        {% endfor %}
                        </ul>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <p>No memories found.</p>
            {% endif %}
        </form>
    </div>
</body>
</html>